import{u as I,a as S,r as o,j as e,c as T,L as q}from"./index-Ce-aIIIL.js";import{p as f}from"./index-CABy_kWu.js";function x({label:a,id:c,error:d,required:u,hint:r,children:b}){return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-ink-700 dark:text-parchment-200 mb-1.5",children:[a,u&&e.jsx("span",{className:"text-rust-500 ml-1","aria-label":"required",children:"*"})]}),r&&e.jsx("p",{className:"text-xs text-ink-400 mb-2",children:r}),b,d&&e.jsx("p",{id:`${c}-error`,role:"alert",className:"text-xs text-rust-500 mt-1.5",children:d})]})}const p={title:a=>a!=null&&a.trim()?a.trim().length<10?"Title must be at least 10 characters.":a.trim().length>300?"Title must be under 300 characters.":null:"Title is required.",categoryId:a=>a?null:"Please select a category.",body:a=>a!=null&&a.trim()?a.trim().length<30?"Content must be at least 30 characters.":null:"Post content is required."};function B(){const{categories:a,submitThread:c,loading:d}=I(),u=S(),[r,b]=o.useState({title:"",categoryId:"",body:"",tagsRaw:""}),[s,g]=o.useState({}),[i,j]=o.useState({}),[k,N]=o.useState(""),h=o.useCallback((t,n)=>{b(l=>({...l,[t]:n})),s[t]&&g(l=>({...l,[t]:null}))},[s]),y=o.useCallback(t=>{j(l=>({...l,[t]:!0}));const n=p[t];if(n){const l=n(r[t]);g(C=>({...C,[t]:l}))}},[r]),v=()=>{const t={};return Object.keys(p).forEach(n=>{const l=p[n](r[n]);l&&(t[n]=l)}),g(t),j({title:!0,categoryId:!0,body:!0}),Object.keys(t).length===0},w=async t=>{if(t.preventDefault(),!!v()){N("");try{const n=await c({title:r.title,body:r.body,categoryId:r.categoryId,tags:f(r.tagsRaw)});u(`/thread/${n.id}`)}catch(n){N(n.message||"Failed to submit. Please try again.")}}},m={title:r.title.length,body:r.body.length};return e.jsxs("form",{onSubmit:w,noValidate:!0,"aria-label":"Create new discussion thread",className:"space-y-6",children:[e.jsx(x,{label:"Category",id:"thread-category",error:i.categoryId?s.categoryId:null,required:!0,children:e.jsxs("select",{id:"thread-category",value:r.categoryId,onChange:t=>h("categoryId",t.target.value),onBlur:()=>y("categoryId"),className:`input-base ${i.categoryId&&s.categoryId?"border-rust-400 ring-2 ring-rust-400/20":""}`,"aria-describedby":i.categoryId&&s.categoryId?"thread-category-error":void 0,"aria-invalid":!!(i.categoryId&&s.categoryId),children:[e.jsx("option",{value:"",children:"Select a category…"}),a.map(t=>e.jsxs("option",{value:t.id,children:[t.icon," ",t.name]},t.id))]})}),e.jsx(x,{label:"Thread Title",id:"thread-title",error:i.title?s.title:null,required:!0,hint:"Write a clear, descriptive title that summarizes your question or topic.",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"thread-title",type:"text",value:r.title,onChange:t=>h("title",t.target.value),onBlur:()=>y("title"),placeholder:"What's on your mind?",className:`input-base pr-16 ${i.title&&s.title?"border-rust-400 ring-2 ring-rust-400/20":""}`,"aria-describedby":i.title&&s.title?"thread-title-error":void 0,"aria-invalid":!!(i.title&&s.title),maxLength:310}),e.jsxs("span",{className:`absolute right-3 top-1/2 -translate-y-1/2 text-xs ${m.title>280?"text-rust-500":"text-ink-400"}`,"aria-live":"polite",children:[m.title,"/300"]})]})}),e.jsxs(x,{label:"Content",id:"thread-body",error:i.body?s.body:null,required:!0,hint:"Provide context, background, and what you're hoping to discuss. Be specific.",children:[e.jsx("textarea",{id:"thread-body",value:r.body,onChange:t=>h("body",t.target.value),onBlur:()=>y("body"),placeholder:"Share your thoughts in detail…",rows:10,className:`input-base resize-y font-body ${i.body&&s.body?"border-rust-400 ring-2 ring-rust-400/20":""}`,"aria-describedby":i.body&&s.body?"thread-body-error":void 0,"aria-invalid":!!(i.body&&s.body)}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsxs("span",{className:`text-xs ${m.body>4500?"text-rust-500":"text-ink-400"}`,"aria-live":"polite",children:[m.body.toLocaleString()," characters"]})})]}),e.jsxs(x,{label:"Tags",id:"thread-tags",hint:"Comma-separated tags (optional, max 5). E.g., 'react, performance, ux'",children:[e.jsx("input",{id:"thread-tags",type:"text",value:r.tagsRaw,onChange:t=>h("tagsRaw",t.target.value),placeholder:"react, performance, ux",className:"input-base"}),r.tagsRaw&&e.jsx("div",{className:"flex gap-1.5 flex-wrap mt-2",children:f(r.tagsRaw).map(t=>e.jsxs("span",{className:"badge bg-parchment-200 text-ink-700 dark:bg-ink-700 dark:text-parchment-200",children:["#",t]},t))})]}),k&&e.jsx("div",{role:"alert",className:"text-sm text-rust-600 dark:text-rust-400 bg-rust-50 dark:bg-rust-900/20 border border-rust-200 dark:border-rust-800 rounded-md px-4 py-3",children:k}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:d.submitting,"aria-busy":d.submitting,children:d.submitting?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"sm",label:"Posting…"}),"Posting…"]}):"Post Thread"}),e.jsx("button",{type:"button",onClick:()=>u(-1),className:"btn-secondary",disabled:d.submitting,children:"Cancel"})]})]})}function R(){return e.jsxs("main",{id:"main-content",className:"max-w-3xl mx-auto px-4 py-8",children:[e.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-6",children:e.jsxs("ol",{className:"flex items-center gap-2 text-sm",children:[e.jsx("li",{children:e.jsx(q,{to:"/",className:"text-ink-400 hover:text-rust-500 transition-colors",children:"Discussions"})}),e.jsx("li",{className:"text-ink-300 dark:text-ink-600","aria-hidden":"true",children:"/"}),e.jsx("li",{className:"text-ink-700 dark:text-parchment-200 font-medium","aria-current":"page",children:"New Thread"})]})}),e.jsxs("header",{className:"mb-8 pb-6 border-b border-parchment-200 dark:border-ink-700",children:[e.jsx("h1",{className:"font-display text-2xl font-semibold text-ink-900 dark:text-parchment-100 mb-2",children:"Start a Discussion"}),e.jsx("p",{className:"text-ink-500 dark:text-ink-400 text-sm",children:"Share a question, idea, or topic with the community. Be clear and specific to get the best responses."})]}),e.jsxs("div",{className:"card p-4 mb-8 bg-parchment-50 dark:bg-ink-800/50 border-parchment-200",children:[e.jsx("h2",{className:"font-semibold text-sm text-ink-700 dark:text-parchment-200 mb-2",children:"Community Guidelines"}),e.jsxs("ul",{className:"text-xs text-ink-500 dark:text-ink-400 space-y-1",children:[e.jsx("li",{children:"• Be respectful and constructive in your discussion"}),e.jsx("li",{children:"• Search before posting to avoid duplicates"}),e.jsx("li",{children:"• Choose the most relevant category"}),e.jsx("li",{children:"• Add context and background to your question"})]})]}),e.jsx(B,{})]})}export{R as default};
